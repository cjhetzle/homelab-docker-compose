services:
  home-assistant:
    container_name: home-assistant
    environment:
      - TZ=${TZ}
    volumes:
      - ${DOCKER_DIR_PREFIX}/homeassistant:/config
    ports:
      - 8123:8123
    restart: always
    image: homeassistant/home-assistant
    networks:
            - traefik
    labels:
            # The labels are usefull for Traefik only
            - traefik.enable=true
            - traefik.docker.network=traefik
            # Get the routes from https
            #- traefik.http.routers.homeassistant-secure.rule=Host(`homeassistant.lan`)
            #- traefik.http.routers.homeassistant-secure.entrypoints=websecure
            # Specify the service name and the service loadbalancer port
            - traefik.http.routers.homeassistant.service=homeassistant-service
            - traefik.http.services.homeassistant-service.loadbalancer.server.port=8123
            # Apply autentificiation with http challenge
            #- traefik.http.routers.homeassistant-secure.tls.certresolver=lets-encr
            # Get the routes from http
            - traefik.http.routers.homeassistant.rule=Host(`homeassistant.lan`)
            - traefik.http.routers.homeassistant.entrypoints=web
            # Redirect these routes to https
            #- traefik.http.middlewares.redirect-to-https.redirectscheme.scheme=https
            #- traefik.http.routers.homeassistant.middlewares=redirect-to-https@docker

networks:
  traefik:
    external: true